# 暂停和恢复 Railway 服务指南

## 🎯 使用场景

适合以下情况暂停服务：

- ✅ 项目开发完成，暂时不使用
- ✅ 等待添加登录功能
- ✅ 避免被他人滥用
- ✅ 节省免费额度
- ✅ 进行重大更新前

---

## 方法 1：完全删除服务（推荐）⭐

### 适用场景
- 短期内不会使用
- 需要完全停止计费
- 可以接受重新部署

### 操作步骤

#### 第 1 步：登录 Railway
```
访问：https://railway.app/
登录你的账号
```

#### 第 2 步：进入项目
```
点击：appealing-vision 项目
```

#### 第 3 步：选择服务
```
点击：rare-wonder 服务卡片
```

#### 第 4 步：进入设置
```
点击顶部的：Settings 标签
```

#### 第 5 步：找到危险区域
```
滚动到页面最底部
找到："Danger Zone" 或 "危险区域"
```

#### 第 6 步：删除服务
```
点击："Remove Service from All Environments"
或："Delete Service"

会弹出确认对话框：
输入服务名称确认：rare-wonder
点击：确认删除
```

#### 第 7 步：确认删除
```
✅ 服务立即停止
✅ 域名失效
✅ 不再计费
✅ 数据清除
```

---

## 方法 2：暂时移除环境

### 适用场景
- 短暂停止，可能马上恢复
- 保留配置信息
- 快速恢复

### 操作步骤

#### 第 1 步：进入项目
```
Railway → appealing-vision → rare-wonder
```

#### 第 2 步：环境管理
```
点击服务卡片右上角的 "..." 菜单
或
点击 Settings → Environments
```

#### 第 3 步：移除环境
```
选择："Remove from production"
或："Delete deployment"

确认操作
```

#### 结果
```
✅ 服务停止运行
✅ 配置保留
✅ 可快速恢复
⚠️ 数据可能清除（取决于配置）
```

---

## 方法 3：禁用自动部署（不推荐）

### 适用场景
- 需要保持服务运行
- 只是暂停代码更新
- 不适合完全停止服务

### 操作步骤
```
Settings → Build & Deploy
→ 关闭 "Auto Deploy"
```

### 注意
```
⚠️ 服务仍在运行
⚠️ 仍会产生费用
⚠️ 不适合本场景
```

---

## 🔄 如何恢复服务

### 恢复方法 1：重新部署（删除后）

#### 第 1 步：创建新服务
```
Railway 项目页面
→ 点击 "New" 
→ 选择 "GitHub Repo"
→ 选择你的仓库：Learning-English-when-whaching-Tv
```

#### 第 2 步：配置服务
```
1. 等待自动检测和部署

2. 配置环境变量（Variables 标签）：
   SECRET_KEY=<重新生成>
   FLASK_ENV=production
   CORS_ORIGINS=https://learning-english-when-whaching-tv.vercel.app,http://localhost:5173
```

#### 第 3 步：生成域名
```
Settings → Networking → Generate Domain
获得新域名（会和之前不同）
```

#### 第 4 步：更新前端配置
```
1. 更新 frontend/vercel.json
   将后端 URL 改为新域名

2. 更新 Railway CORS_ORIGINS
   包含 Vercel 前端域名

3. Git 提交并推送
```

#### 第 5 步：测试验证
```
访问前端网站
测试 API 连接
确认功能正常
```

---

### 恢复方法 2：重新部署环境（移除后）

#### 第 1 步：重新部署
```
Railway 项目页面
→ 点击服务
→ 点击 "Deploy"
或
Settings → 点击 "Redeploy"
```

#### 第 2 步：等待部署完成
```
查看 Deployments 标签
等待状态变为 Active
```

#### 第 3 步：测试
```
访问原域名（如果还在）
测试功能
```

---

## 💰 费用说明

### Railway 免费额度

```
免费计划：
├─ 每月 $5 免费额度
├─ 约 500 小时运行时间
├─ 500 小时 = 20.8 天
└─ 适合小型项目

计费规则：
├─ 按秒计费
├─ 运行时才计费
├─ 停止后不计费
└─ 每月重置额度
```

### 暂停后的费用

```
✅ 删除服务：
   └─ 费用：$0
   └─ 完全停止计费

✅ 移除环境：
   └─ 费用：$0（如果彻底停止）
   └─ 不再运行，不产生费用

❌ 禁用部署（服务仍运行）：
   └─ 费用：继续计费
   └─ 不适合停止服务
```

### 查看费用

```
Railway 首页
→ 点击右上角头像
→ "Usage"
→ 查看当月使用情况
```

---

## 📝 暂停前的准备工作

### 1. 备份重要配置

```bash
# 保存环境变量
SECRET_KEY=<你的密钥>
FLASK_ENV=production
CORS_ORIGINS=https://learning-english-when-whaching-tv.vercel.app,http://localhost:5173
YOUDAO_APP_KEY=<如果有>
YOUDAO_APP_SECRET=<如果有>

# 保存域名
后端域名: https://rare-wonder-production.up.railway.app
```

### 2. 导出数据（如果有重要数据）

```python
# 如果需要保存数据
# 可以先导出数据库

# 方法1：通过 Railway CLI
railway run python
>>> from app import db
>>> # 导出数据的代码

# 方法2：连接数据库导出
# 使用数据库管理工具
```

### 3. 通知用户（如果有）

```
如果有用户在使用：
1. 提前通知暂停时间
2. 说明原因
3. 告知恢复时间
```

### 4. 更新文档

```markdown
# README.md
⚠️ 注意：服务暂时停止中

原因：等待添加用户认证功能
预计恢复：<日期>
```

---

## 🚨 注意事项

### ⚠️ 删除前必读

```
1. 数据会丢失
   └─ SQLite 数据会清空
   └─ 如需保留，先导出

2. 域名会变化
   └─ 新部署会生成新域名
   └─ 需要更新前端配置

3. 环境变量需重新配置
   └─ 保存当前配置
   └─ 部署后重新添加

4. 前端需要更新
   └─ 修改 vercel.json
   └─ 重新部署前端
```

### ✅ 删除后可以做什么

```
1. 安心开发登录功能
   └─ 本地测试

2. 完善功能
   └─ 添加用户认证
   └─ 添加权限控制
   └─ 完善数据验证

3. 优化项目
   └─ 代码重构
   └─ 性能优化
   └─ 安全加固
```

---

## 🔐 添加登录功能后的部署

### 建议的功能清单

```
用户认证系统：
├─ 用户注册
├─ 用户登录
├─ JWT Token 认证
├─ 密码加密
└─ Session 管理

权限控制：
├─ API 权限验证
├─ 限制请求频率
├─ 防止爬虫
└─ 数据访问控制

安全措施：
├─ HTTPS 强制
├─ CSRF 保护
├─ XSS 防护
├─ SQL 注入防护
└─ 限流和防刷
```

### 重新部署检查清单

```
部署前检查：
[ ] 用户认证功能完成
[ ] 所有 API 都需要登录
[ ] 密码安全存储
[ ] Token 机制正常
[ ] 限流配置完成
[ ] 测试通过

部署时配置：
[ ] 重新部署到 Railway
[ ] 配置环境变量
[ ] 生成新域名
[ ] 更新前端配置
[ ] 测试登录功能
[ ] 验证 API 保护
```

---

## 💡 最佳实践

### 开发阶段

```
1. 本地开发 💻
   └─ 完整实现功能
   └─ 本地测试验证

2. 功能完善 ✅
   └─ 用户认证
   └─ 权限控制
   └─ 数据验证

3. 安全检查 🔐
   └─ 代码审查
   └─ 安全测试
   └─ 漏洞扫描

4. 正式部署 🚀
   └─ 部署到 Railway
   └─ 全面测试
   └─ 监控运行
```

### 生产环境保护

```
必要措施：
1. 用户认证 ✅
   └─ 防止未授权访问

2. 限流保护 ✅
   └─ 防止滥用和爬虫

3. 数据持久化 ✅
   └─ 使用 PostgreSQL

4. 监控报警 ✅
   └─ 实时监控异常

5. 备份策略 ✅
   └─ 定期备份数据
```

---

## 📊 暂停 vs 继续运行对比

### 现在暂停（推荐）✅

```
优点：
✅ 节省免费额度
✅ 避免被滥用
✅ 有时间完善功能
✅ 可以重构代码
✅ 没有安全风险

缺点：
⚠️ 需要重新部署
⚠️ 前端需要更新
⚠️ 用户暂时无法访问
```

### 继续运行（不推荐）❌

```
优点：
✅ 可以继续演示
✅ 不需要重新配置

缺点：
❌ 可能被他人使用
❌ 消耗免费额度
❌ 没有访问控制
❌ 数据可能被污染
❌ 存在安全隐患
```

---

## 🎯 推荐操作流程

### 立即操作

```
1. 现在立即暂停服务 🛑
   └─ Railway 删除服务
   └─ 保存配置信息

2. 在前端显示通知 📝
   └─ 说明服务暂停
   └─ 预计恢复时间

3. 本地开发登录功能 💻
   └─ 用户注册/登录
   └─ Token 认证
   └─ 权限控制

4. 完整测试 🧪
   └─ 本地测试
   └─ 功能测试
   └─ 安全测试

5. 重新部署 🚀
   └─ Railway 部署
   └─ 配置环境变量
   └─ 更新前端
   └─ 全面测试
```

### 时间估算

```
暂停服务：5 分钟
开发登录功能：2-3 天
测试验证：半天
重新部署：1 小时
━━━━━━━━━━━━━━━━━
总计：3-4 天
```

---

## 🆘 常见问题

### Q1: 删除后数据会丢失吗？

**A:** 会的

```
当前使用 SQLite：
├─ 数据存储在容器中
├─ 删除服务后数据清空
└─ 目前数据不多，影响不大

建议：
├─ 测试数据可以重新创建
├─ 如有重要数据，先导出
└─ 以后使用 PostgreSQL 持久化
```

### Q2: 域名会变吗？

**A:** 会变

```
删除后重新部署：
├─ 生成新的域名
├─ 格式: xxx-production.up.railway.app
└─ 需要更新前端配置

保留域名的方法：
├─ 不要删除服务
├─ 使用自定义域名
└─ 或使用 "移除环境" 而不是删除
```

### Q3: 环境变量会保留吗？

**A:** 不会

```
删除服务后：
├─ 所有配置清空
├─ 环境变量丢失
└─ 需要重新配置

建议：
├─ 提前保存配置
├─ 记录在文档中
└─ 使用密码管理器
```

### Q4: 前端也要停止吗？

**A:** 可以保留，但建议添加提示

```
前端可以继续运行：
├─ Vercel 继续托管
├─ 用户可以访问
└─ 但 API 会失败

建议：
├─ 添加维护通知页面
├─ 说明原因
└─ 告知恢复时间
```

### Q5: 免费额度会重置吗？

**A:** 每月重置

```
Railway 免费额度：
├─ 每月 $5
├─ 每月 1 号重置
├─ 用完后暂停服务
└─ 或升级付费计划

当前使用：
├─ 查看 Usage 页面
├─ 监控使用情况
└─ 合理安排部署
```

### Q6: 多久后可以恢复？

**A:** 随时可以

```
恢复时间：
├─ 重新部署: 5-10 分钟
├─ 配置环境: 5 分钟
├─ 更新前端: 5 分钟
├─ 测试验证: 10 分钟
└─ 总计: 30 分钟左右

只要你：
├─ 代码在 GitHub
├─ 保存了配置
└─ 随时可以恢复
```

---

## 🎓 学习资源

### 用户认证教程

```
推荐学习：
1. Flask-Login
   └─ https://flask-login.readthedocs.io/

2. JWT 认证
   └─ Flask-JWT-Extended

3. 密码加密
   └─ Werkzeug.security

4. Session 管理
   └─ Flask-Session
```

### 安全最佳实践

```
必读文档：
1. OWASP Top 10
2. Flask 安全指南
3. API 安全设计
4. 数据库安全
```

---

## 📞 需要帮助？

### 遇到问题时

```
1. 查看 Railway 文档
   └─ https://docs.railway.app/

2. 检查错误日志
   └─ Railway Deployments → Logs

3. 查看项目文档
   └─ 部署问题总结与解决方案.md

4. 提问
   └─ 描述问题
   └─ 提供截图
   └─ 我会帮你解决
```

---

## 🎯 总结

### 推荐操作

```
✅ 立即暂停 Railway 服务
   └─ 删除服务（完全停止）
   └─ 保存配置信息

✅ 开发登录功能
   └─ 本地开发和测试
   └─ 完善安全措施

✅ 重新部署
   └─ 功能完善后
   └─ 全面测试后上线
```

### 关键要点

```
1. 暂停是明智的选择 ✅
   └─ 保护项目安全
   └─ 节省资源

2. 删除很简单 ✅
   └─ Railway Settings → Delete
   └─ 5 分钟完成

3. 恢复也很快 ✅
   └─ 重新部署
   └─ 30 分钟恢复

4. 利用这段时间 ✅
   └─ 完善功能
   └─ 提升安全
```

---

**现在就去 Railway 暂停服务吧！** 🛑

完善登录功能后再上线，这样更安全！💪

---

**文档版本：** v1.0  
**创建日期：** 2025-11-12  
**适用项目：** 美剧单词学习助手

