# 🚀 Railway 部署问题快速修复指南

## 📌 问题分析

**错误信息：** `ImportError: Cannot find config.py in /app`

**根本原因：**
1. ❌ `config.py` 被 `.gitignore` 忽略，没有上传到 GitHub
2. ❌ Railway 启动命令配置不正确

## ✅ 已完成的修复

我已经帮你修复了以下文件：

### 1. `.gitignore`
```diff
- config.py
+ # config.py  # 已移除，因为敏感信息都使用环境变量
```

### 2. `backend/railway.json`
```json
{
  "build": {
    "buildCommand": "cd backend && pip install -r requirements.txt"
  },
  "deploy": {
    "startCommand": "cd backend && gunicorn run:app --bind 0.0.0.0:$PORT"
  }
}
```

---

## 📤 上传代码到 GitHub（使用 Clash 代理）

### 第一步：配置 Git 代理

打开 **PowerShell**，执行：

```powershell
# 配置代理（确保 Clash 正在运行，端口通常是 7890）
git config --global http.proxy http://127.0.0.1:7890
git config --global https.proxy http://127.0.0.1:7890
```

### 第二步：上传代码

```powershell
# 1. 进入项目目录
cd C:\AIProject

# 2. 添加修改的文件
git add .

# 3. 提交更改
git commit -m "修复Railway部署问题：添加config.py和修复启动命令"

# 4. 推送到 GitHub
git push origin main
```

**注意：** 如果提示输入 GitHub 用户名和密码，可能需要使用 Personal Access Token（不是账号密码）

---

## ⚙️ Railway 环境变量配置

上传完成后，在 **Railway 项目页面** 设置环境变量：

1. 点击项目名称
2. 点击 **"Variables"** 标签
3. 添加以下变量：

| 变量名 | 值 | 说明 |
|--------|-----|------|
| `SECRET_KEY` | 随机字符串 | **必需**，Flask 密钥 |
| `FLASK_ENV` | `production` | **必需**，生产环境 |
| `YOUDAO_APP_KEY` | 你的 API Key | 可选，翻译 API |
| `YOUDAO_APP_SECRET` | 你的 API Secret | 可选，翻译 API |
| `CORS_ORIGINS` | `https://your-frontend.vercel.app` | 前端域名 |

**生成 SECRET_KEY：**
```powershell
python -c "import secrets; print(secrets.token_hex(32))"
```

复制输出的字符串，粘贴到 Railway 的 `SECRET_KEY` 变量中。

---

## 🔄 等待自动部署

上传代码后，Railway 会自动：
1. ✅ 检测代码更新
2. ✅ 拉取最新代码
3. ✅ 重新构建
4. ✅ 自动部署

**预计时间：** 3-5 分钟

你可以在 Railway 的 **"Deployments"** 标签查看部署进度和日志。

---

## ✅ 测试部署

部署完成后，访问：

```
https://你的应用名.railway.app/api/statistics/overview
```

**预期结果：** 看到 JSON 数据

```json
{
  "total_words": 0,
  "learned_words": 0,
  ...
}
```

如果看到上面的 JSON 数据，说明 **部署成功**！🎉

---

## 🔍 常见问题

### 1. Git 推送很慢或失败

**解决：**
```powershell
# 确保 Clash 正在运行
# 检查代理端口（可能是 7890, 7891, 1080）
git config --global http.proxy http://127.0.0.1:你的端口

# 增加超时时间
git config --global http.postBuffer 524288000
```

### 2. Railway 还是报同样的错误

**检查：**
1. 确认 `backend/config.py` 已经上传到 GitHub（去 GitHub 网页上查看）
2. 确认 Railway 已经自动重新部署（查看 Deployments 时间）
3. 如果没有自动部署，手动点击 "Deploy Now"

### 3. 提示 GitHub 认证失败

**解决：**
需要使用 Personal Access Token：

1. 访问 GitHub：Settings → Developer settings → Personal access tokens
2. 生成新 token（勾选 `repo` 权限）
3. 使用 token 作为密码（用户名是你的 GitHub 用户名）

### 4. Railway 日志显示其他错误

**查看日志：**
1. Railway 项目 → Deployments
2. 点击最新的部署
3. 查看 "Logs" 查找具体错误

**常见错误：**
- 缺少环境变量 → 添加 `SECRET_KEY` 和 `FLASK_ENV`
- 端口占用 → Railway 会自动处理，等待重启
- CORS 错误 → 设置正确的 `CORS_ORIGINS`

---

## 📚 详细文档

如果需要更详细的说明，请查看：

- **📄 RAILWAY_FIX_SUMMARY.md** - 修复内容详细说明
- **📄 GIT_UPLOAD_GUIDE.md** - Git 上传完整指南
- **📄 DEPLOY.md** - 完整部署教程

---

## 📞 需要帮助？

如果按照以上步骤仍然遇到问题：

1. ✅ 检查 Clash 是否正在运行
2. ✅ 确认代码已上传到 GitHub
3. ✅ 查看 Railway 部署日志
4. ✅ 确认环境变量已设置

---

## 🎯 操作步骤总结

```
1. 配置 Git 代理 ✅（已完成）
   ↓
2. 上传代码到 GitHub ⏳（需要操作）
   ↓
3. Railway 自动部署 ⏳（自动完成）
   ↓
4. 设置环境变量 ⏳（需要操作）
   ↓
5. 测试访问 ⏳（验证）
   ↓
6. 部署成功！🎉
```

**祝你部署顺利！** 🚀

